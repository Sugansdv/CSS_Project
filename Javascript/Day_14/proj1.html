<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Typing Speed Tester</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    #sentence { font-size: 1.5em; margin: 20px 0; padding: 15px; background: #f5f5f5; min-height: 100px; }
    #input { width: 100%; padding: 10px; font-size: 1.2em; }
    .correct { color: green; }
    .incorrect { color: red; text-decoration: underline; }
  </style>
</head>
<body>

<h1>Typing Speed Tester</h1>

<div id="sentence">Click "New Sentence" to start!</div>
<textarea id="input" placeholder="Start typing here..." disabled></textarea>

<div>
  <div>Time: <span id="time">0s</span></div>
  <div>Speed: <span id="speed">0 WPM</span></div>
  <div>Accuracy: <span id="accuracy">100%</span></div>
</div>

<button id="newSentence">New Sentence</button>

<script>
  const sentenceElement = document.getElementById('sentence');
  const inputElement = document.getElementById('input');
  const timeElement = document.getElementById('time');
  const speedElement = document.getElementById('speed');
  const accuracyElement = document.getElementById('accuracy');
  const newSentenceBtn = document.getElementById('newSentence');

  let startTime, timer, currentSentence = '', isTyping = false;

  newSentenceBtn.addEventListener('click', init);
  inputElement.addEventListener('input', checkTyping);

  async function init() {
    clearInterval(timer);
    inputElement.value = '';
    timeElement.textContent = '0s';
    speedElement.textContent = '0 WPM';
    accuracyElement.textContent = '100%';
    isTyping = false;
    inputElement.disabled = false;

    try {
      currentSentence = await fetchSentence();
      sentenceElement.textContent = currentSentence;
      inputElement.focus();
    } catch (error) {
      console.error('Error fetching sentence:', error);
      sentenceElement.innerHTML = 'Failed to fetch a sentence. Try again!';
      inputElement.disabled = true;
    }
  }

  async function fetchSentence() {
    const url = 'https://quotes15.p.rapidapi.com/quotes/random/';
    const options = {
      method: 'GET',
      headers: {
        'X-RapidAPI-Key': '7e9212afcmsh651dbaad1f4895cp150738jsn379f7af00e2a', // your key
        'X-RapidAPI-Host': 'quotes15.p.rapidapi.com'
      }
    };

    const response = await fetch(url, options);

    if (!response.ok) {
      throw new Error('Network response was not OK');
    }

    const data = await response.json();
    console.log(data); // check the data in console

    if (data.content) {
      return data.content;
    } else {
      return "Keep trying, success is near!"; // fallback sentence
    }
  }

  function checkTyping() {
    const inputText = inputElement.value;

    if (!isTyping && inputText.length > 0) {
      startTime = new Date();
      timer = setInterval(updateStats, 100);
      isTyping = true;
    }

    let correctChars = 0;
    for (let i = 0; i < currentSentence.length; i++) {
      if (inputText[i] === currentSentence[i]) {
        correctChars++;
      }
    }

    const accuracy = inputText.length > 0 
      ? Math.round((correctChars / inputText.length) * 100) 
      : 100;
    accuracyElement.textContent = `${accuracy}%`;

    if (inputText.length === currentSentence.length) {
      clearInterval(timer);
      inputElement.disabled = true;
      isTyping = false;
    }
  }

  function updateStats() {
    const currentTime = new Date();
    const timeElapsed = (currentTime - startTime) / 1000;
    timeElement.textContent = `${timeElapsed.toFixed(1)}s`;

    const wordsTyped = inputElement.value.length / 5;
    const minutes = timeElapsed / 60;
    const wpm = Math.round(wordsTyped / minutes) || 0;
    speedElement.textContent = `${wpm} WPM`;
  }
</script>

</body>
</html>
